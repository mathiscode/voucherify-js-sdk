!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("@voucherify/sdk")):"function"==typeof define&&define.amd?define(["exports","react","@voucherify/sdk"],n):n((e=e||self).VoucherifyWidget={},e.React,e.VoucherifySDK)}(this,(function(e,n,t){"use strict";function i(){return(i=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}function r(e){var t=e.src;return n.createElement("figure",{className:"voucherifyLogo"},t?n.createElement("img",{className:"voucherifyLogo",src:t,alt:e.alt}):n.createElement("svg",{className:"voucherifyLogo",viewBox:"0 0 46 45"},n.createElement("path",{fill:"currentColor","fill-rule":"nonzero",d:"M18.494 3.174c2.112 2.131 3.145 4.69 3.145 7.72 0 3.032-1.033 5.59-3.145 7.722-2.112 2.131-4.647 3.173-7.651 3.173-3.004 0-5.539-1.042-7.651-3.173C1.032 16.532 0 13.926 0 10.942s1.033-5.637 3.145-7.768C5.257 1.042 7.839 0 10.843 0c2.957 0 5.539 1.042 7.65 3.174zm-7.651 1.231c-1.784 0-3.286.616-4.553 1.895-1.268 1.279-1.878 2.795-1.878 4.595 0 1.8.61 3.316 1.878 4.594 1.267 1.28 2.77 1.895 4.553 1.895 1.784 0 3.286-.616 4.553-1.895 1.267-1.278 1.877-2.794 1.877-4.594 0-1.8-.61-3.316-1.877-4.595-1.267-1.232-2.77-1.895-4.553-1.895zM34.782 44.574c-3.051-.19-5.54-1.232-7.51-3.221-2.066-2.085-3.145-5.21-3.145-8.195v-.569c0-.852.234-1.468.657-1.942.422-.426.938-.663 1.549-.663.61 0 1.126.237 1.549.663.422.427.657 1.042.657 1.895v.947c.094 1.611.704 3.553 1.877 4.69 1.268 1.279 2.77 1.895 4.553 1.895h.094c1.784 0 3.286-.616 4.553-1.895 1.174-1.137 1.784-3.079 1.878-4.69v-.947c0-.805.235-1.42.657-1.895.422-.426.939-.663 1.549-.663s1.127.237 1.549.663c.422.427.657 1.09.657 1.942v.569c-.047 2.984-1.08 6.063-3.145 8.195-1.971 1.99-4.459 3.079-7.51 3.22h-.47zM6.102 42.916c-.563 0-1.126-.237-1.596-.663-.892-.9-.892-2.321 0-3.174L40.367 2.937c.892-.9 2.3-.9 3.145 0 .892.9.892 2.32 0 3.174L7.698 42.253a2.307 2.307 0 01-1.596.663z"})))}function o(e){var n,t,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(t=o(e[n]))&&(i&&(i+=" "),i+=t);else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function u(){for(var e,n,t=0,i="";t<arguments.length;)(e=arguments[t++])&&(n=o(e))&&(i&&(i+=" "),i+=n);return i}var c=function(e){return e.split("_").map((function(e){return(n=e).charAt(0).toUpperCase()+n.slice(1);var n})).join("")},a=function e(n){return Object.keys(n).forEach((function(t){return n[t]&&"object"==typeof n[t]&&e(n[t])||!n[t]&&(void 0!==n[t]||""===n[t])&&delete n[t]})),n},l=function(e){return/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/im.test(e)},s=function(e){return/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/i.test(e.toLowerCase())};function f(e){var i=n.useState((function(){return t.VoucherifyClientSide(e)})),r=i[0],o=i[1],u=n.useState(!1),c=u[0],a=u[1];return n.useEffect((function(){o(t.VoucherifyClientSide(e))}),[e.apiUrl,e.clientApplicationId,e.clientSecretKey,e.trackingId,e.origin]),[r,c,a]}function m(){return{voucherifyCode:"",voucherifyAmount:"",voucherifyDiscountType:"",voucherifyPercentOff:0,voucherifyAmountOff:0,voucherifyUnitOff:0,voucherifyTracking:""}}function y(){return{voucherifyCode:!1,voucherifyAmount:!1,voucherifyValidate:!1}}function h(){return{name:"",email:"",phone:"",line_1:"",line_2:"",postal_code:"",city:"",state:"",country:"",voucherifyPublishStatus:"",voucherifyTracking:"",voucherifyPublish:""}}function v(){return{name:!0,phone:!0,email:!0,line_1:!0,line_2:!0,postal_code:!0,city:!0,state:!0,country:!0,voucherifyPublishStatus:!0,voucherifyPublish:!0}}function d(){return{voucherifyCode:"",voucherifyAmount:"",voucherifyTracking:""}}function p(){return{voucherifyCode:!1,voucherifyAmount:!1,voucherifyRedeem:!1}}function g(){return{voucherifyCode:!1,voucherifyAmount:!1,voucherifyRedeem:!1}}function b(){return{name:"",email:"",phone:"",line_1:"",line_2:"",postal_code:"",city:"",state:"",country:"",voucherifySubscribeStatus:"",voucherifySubscribe:""}}function S(){return{name:!0,phone:!0,email:!0,line_1:!0,line_2:!0,postal_code:!0,city:!0,state:!0,country:!0,voucherifySubscribeStatus:!0,voucherifySubscribe:!0}}var k="We ran into a configuration error. Please try that again. If the error persists, please contact support.";e.VoucherifyPublish=function(e){var t=e.apiUrl,o=e.clientApplicationId,m=e.clientSecretKey,y=e.trackingId,d=e.origin,p=e.logoSrc,g=e.logoAlt,b=e.onPublished,S=e.onError,k=e.campaignName,C=e.customerFields,_=void 0===C?[]:C,I=e.customerNamePlaceholder,A=e.customerEmailPlaceholder,E=e.customerPhonePlaceholder,N=e.customerLine1Placeholder,P=e.customerLine2Placeholder,T=e.customerPostalCodePlaceholder,O=e.customerCityPlaceholder,V=e.customerStatePlaceholder,x=e.customerCountryPlaceholder,U=e.textPublish,R=void 0===U?"Get voucher":U,j=e.classInvalid||"voucherifyInvalid",w=e.classValid||"voucherifyValid",D=e.classInvalidAnimation||"voucherifyAnimationShake",F=e.classValidAnimation||"voucherifyAnimationTada",K=n.useState(!1),L=K[0],M=K[1],q=n.useState(!0),W=q[0],z=q[1],B=n.useState(!1),G=B[0],J=B[1],$=f({apiUrl:t,clientApplicationId:o,clientSecretKey:m,trackingId:y,origin:d}),H=$[0],Q=$[1],X=$[2],Y=function(){var e=n.useState(h),t=e[0],r=e[1],o=n.useState(v),u=o[1];return{input:t,inputStates:o[0],onInputChange:n.useCallback((function(e){var n=e.target.name;r((function(t){var r;return i({},t,((r={})[n]=e.target.value,r))}))}),[]),resetInputs:n.useCallback((function(){r(h),u(v)}),[]),setInput:r,setInputState:u}}(),Z=Y.input,ee=Y.inputStates,ne=Y.onInputChange,te=Y.resetInputs,ie=Y.setInput,re=Y.setInputState;n.useEffect((function(){te(),M(!1)}),[H]);var oe=Object.keys(Z).map((function(e){return{name:e,classes:u(["voucherifyPublishStatus"===e||"voucherifyTracking"===e||"voucherifyPublish"===e?e:"voucherifyCustomer"+c(e),G?ee[e]?"":j+" "+D:""])}})),ue={name:"e.g. Bruce Wayne",email:"e.g. bruce@wayne.com",phone:"e.g. +48 000 000 000",line_1:"e.g. Wayne Manor",line_2:"e.g. 22B",postal_code:"e.g. 00-0014",city:"e.g. Gotham",state:"e.g. New Jersey",country:"e.g. USA"},ce=function(e,t){return void 0===t&&(t=""),n.createElement("input",{type:"phone"===e?"tel":"email"===e?"email":"text",placeholder:t||ue[""+e],name:e,value:Z[""+e],onChange:ne,className:oe.find((function(n){return n.name===e})).classes,disabled:Q||L,style:{display:W?"block":"none"}})},ae=n.useCallback((function(e){X(!0),ie((function(e){return i({},e,{voucherifyPublishStatus:"",voucherifyTracking:""})})),J(!0);var n={customer:{name:Z.name,phone:Z.phone.replace(/[\r\n\t\f\s\v]/g,"").trim(),email:Z.email,source_id:Z.email,address:{line_1:Z.line_1,line_2:Z.line_2,postal_code:Z.postal_code,city:Z.city,state:Z.state,country:Z.country}}},t=a(n),r=_.reduce((function(e,n){return n.required&&""===Z[n.name].trim()?(e[n.name]=!1,e):"phone"===n.name&&""!==Z.phone.replace(/[\r\n\t\f\s\v]/g,"").trim()?(e.phone=l(Z.phone.replace(/[\r\n\t\f\s\v]/g,"").trim()),e):"email"===n.name&&""!==Z.email.replace(/[\r\n\t\f\s\v]/g,"").trim()?(e.email=s(Z.email.replace(/[\r\n\t\f\s\v]/g,"").trim()),e):(e[n.name]=!0,e)}),{name:!0,email:!0,phone:!0,line_1:!0,line_2:!0,postal_code:!0,city:!0,state:!0,country:!0,voucherifyPublishStatus:!0,voucherifyPublish:!0});re((function(e){return i({},e,r)})),Object.values(r).some((function(e){return!e}))?X(!1):H.publish(k,t).then((function(e){var n=e;ie((function(e){return i({},e,{name:"",email:"",phone:"",line_1:"",line_2:"",postal_code:"",city:"",state:"",country:"",voucherifyTracking:(null==n?void 0:n.tracking_id)||"",voucherifyPublishStatus:n.voucher.code})})),M(!0),z(!1),re((function(e){return i({},e,{voucherifyPublishStatus:!0})})),"function"==typeof b&&b(n)})).catch((function(e){console.error(e),re((function(e){return i({},e,{voucherifyPublish:!1})})),"function"==typeof S&&S(e)})).finally((function(){return X(!1)}))}),[Z,S,b]);return n.createElement("div",{className:"voucherifyContainer wide"},n.createElement(r,{src:p,alt:g}),_.some((function(e){return"name"===e.name}))&&ce("name",I),_.some((function(e){return"email"===e.name||"phone"===e.name}))&&n.createElement("div",{className:"voucherifyRow",style:{display:W?"flex":"none"}},_.some((function(e){return"email"===e.name}))&&ce("email",A),_.some((function(e){return"phone"===e.name}))&&ce("phone",E)),_.some((function(e){return"line_1"===e.name}))&&ce("line_1",N),_.some((function(e){return"line_2"===e.name}))&&ce("line_2",P),_.some((function(e){return"postal_code"===e.name||"city"===e.name}))&&n.createElement("div",{className:"voucherifyRow",style:{display:W?"flex":"none"}},_.some((function(e){return"postal_code"===e.name}))&&ce("postal_code",T),_.some((function(e){return"city"===e.name}))&&ce("city",O)),_.some((function(e){return"state"===e.name||"country"===e.name}))&&n.createElement("div",{className:"voucherifyRow",style:{display:W?"flex":"none"}},_.some((function(e){return"state"===e.name}))&&ce("state",V),_.some((function(e){return"country"===e.name}))&&ce("country",x)),n.createElement("input",{type:"hidden",name:"voucherifyTracking",value:Z.voucherifyTracking,className:"voucherifyTracking"}),n.createElement("input",{type:"text",name:"voucherifyPublishStatus",className:"voucherifyPublishStatus "+w+" "+F,value:Z.voucherifyPublishStatus,style:{display:W?"none":"block"}}),n.createElement("button",{className:oe.find((function(e){return"voucherifyPublish"===e.name})).classes,disabled:Q||L,onClick:ae,style:{display:W?"block":"none"}},n.createElement("span",{className:"VoucherifyPublishText"},R)))},e.VoucherifyRedeem=function(e){var t=e.apiUrl,o=e.clientApplicationId,c=e.clientSecretKey,l=e.trackingId,s=e.origin,m=e.logoSrc,y=e.logoAlt,h=e.onRedeemed,v=e.onError,b=e.amount,S=e.textPlaceholder,k=e.amountPlaceholder,C=e.textRedeem,_=void 0===C?"Redeem":C,I=e.classInvalid||"voucherifyInvalid",A=e.classValid||"voucherifyValid",E=e.classInvalidAnimation||"voucherifyAnimationShake",N=e.classValidAnimation||"voucherifyAnimationTada",P=n.useState(!1),T=P[0],O=P[1],V=n.useState(!1),x=V[0],U=V[1],R=f({apiUrl:t,clientApplicationId:o,clientSecretKey:c,trackingId:l,origin:s}),j=R[0],w=R[1],D=R[2],F=function(){var e=n.useState(d),t=e[0],r=e[1],o=n.useState(p),u=o[0],c=o[1],a=n.useState(g);return{input:t,inputStates:u,inputValidStates:a[0],setValidInputState:a[1],onInputChange:n.useCallback((function(e){var n=e.target.name;r((function(t){var r;return i({},t,((r={})[n]=e.target.value,r))}))}),[]),resetInputs:n.useCallback((function(){r(d),c(p)}),[]),setInput:r,setInputState:c}}(),K=F.input,L=F.inputStates,M=F.onInputChange,q=F.resetInputs,W=F.setInput,z=F.setInputState,B=F.inputValidStates,G=F.setValidInputState;n.useEffect((function(){q(),O(!1)}),[j]);var J=Object.keys(L).map((function(e){return{name:e,classes:u([e,x&&L[e]?I+" "+E:"",x&&B[e]?A+" "+N:""])}})),$=n.useCallback((function(e){W((function(e){return i({},e,{voucherifyTracking:""})})),U(!0);var n={order:{amount:""===K.voucherifyAmount.trim()||isNaN(parseInt((100*parseFloat(K.voucherifyAmount.replace(/,/,"."))).toString(),10))?0:parseInt((100*parseFloat(K.voucherifyAmount.replace(/,/,"."))).toString(),10)}},t=a(n),r=K.voucherifyCode.replace(/[\r\n\t\f\v]/g,"").trim();if(!r||""!==K.voucherifyAmount.trim()&&isNaN(parseInt((100*parseFloat(K.voucherifyAmount.replace(/,/,"."))).toString(),10)))return z((function(e){return i({},e,{voucherifyCode:!r,voucherifyAmount:!(!b||!isNaN(parseInt((100*parseFloat(K.voucherifyAmount.replace(/,/,"."))).toString(),10)))})}));D(!0),j.redeem(r,t).then((function(e){var n=e;n&&"SUCCESS"===n.result||z((function(e){return i({},e,{voucherifyRedeem:!0})})),W((function(e){return i({},e,{voucherifyTracking:(null==n?void 0:n.tracking_id)||""})})),O(!0),G((function(e){return i({},e,{voucherifyCode:!0,voucherifyAmount:!0,voucherifyRedeem:!0})})),"function"==typeof h&&h(n)})).catch((function(e){console.error(e),z((function(e){return i({},e,{voucherifyRedeem:!0,voucherifyAmount:!0,voucherifyCode:!0})})),"function"==typeof v&&v(e)})).finally((function(){return D(!1)}))}),[K,v,h,b]);return n.createElement("div",{className:"voucherifyContainer"},n.createElement(r,{src:m,alt:y}),n.createElement("input",{type:"text",placeholder:S||"e.g. abc-123",name:"voucherifyCode",value:K.voucherifyCode,onChange:M,className:J.find((function(e){return"voucherifyCode"===e.name})).classes,disabled:w||T}),n.createElement("input",{type:b?"text":"hidden",placeholder:k||"e.g. 52.22",name:"voucherifyAmount",value:K.voucherifyAmount,onChange:M,className:J.find((function(e){return"voucherifyAmount"===e.name})).classes,disabled:w||T}),n.createElement("input",{type:"hidden",name:"voucherifyTracking",value:K.voucherifyTracking,className:"voucherifyTracking"}),n.createElement("button",{className:J.find((function(e){return"voucherifyRedeem"===e.name})).classes,disabled:w||T,onClick:$},n.createElement("span",{className:"voucherifyRedeemText"},_)))},e.VoucherifySubscribe=function(e){var t,o,m,y,h,v,d,p,g=e.apiUrl,C=e.clientApplicationId,_=e.clientSecretKey,I=e.trackingId,A=e.origin,E=e.logoSrc,N=e.logoAlt,P=e.consents,T=e.onSubscribed,O=e.onError,V=e.emailPlaceholder,x=e.customerFields,U=void 0===x?[]:x,R=e.enableDoubleOptIn,j=void 0!==R&&R,w=e.textSubscribe,D=void 0===w?"Subscribe":w,F=e.textSubscribeSuccess,K=void 0===F?"Thank you for subscribing":F,L=e.classInvalid||"voucherifyInvalid",M=e.classValid||"voucherifyValid",q=e.classInvalidAnimation||"voucherifyAnimationShake",W=e.classValidAnimation||"voucherifyAnimationTada",z=n.useState(!1),B=z[0],G=z[1],J=n.useState(!0),$=J[0],H=J[1],Q=n.useState(!1),X=Q[0],Y=Q[1],Z=n.useState(!1),ee=Z[0],ne=Z[1],te=n.useState(!0),ie=te[0],re=te[1],oe=f({apiUrl:g,clientApplicationId:C,clientSecretKey:_,trackingId:I,origin:A}),ue=oe[0],ce=oe[1],ae=oe[2],le=n.useState([]),se=le[0],fe=le[1],me=[].concat(U,[{name:"email",required:!0,placeholder:V}],P),ye=function(){var e=n.useState(b),t=e[0],r=e[1],o=n.useState(S),u=o[1];return{input:t,inputStates:o[0],onInputChange:n.useCallback((function(e){var n=e.target.name;r("off"===e.target.value?function(e){var t;return i({},e,((t={})[n]="on",t))}:"on"===e.target.value?function(e){var t;return i({},e,((t={})[n]="off",t))}:function(t){var r;return i({},t,((r={})[n]=e.target.value,r))})}),[]),resetInputs:n.useCallback((function(){r(b),u(S)}),[]),setInput:r,setInputState:u}}(),he=ye.input,ve=ye.inputStates,de=ye.onInputChange,pe=ye.resetInputs,ge=ye.setInput,be=ye.setInputState;n.useEffect((function(){pe(),G(!1)}),[ue]);var Se=n.useCallback((function(){j||P===[]||void 0===P?re(!1):ue.listConsents().then((function(e){var n=e.consents.data.filter((function(e){return P.some((function(n){return e.id===(null==n?void 0:n.id)}))}));if(0===n.length||n.length!==P.length)be((function(e){return i({},e,{voucherifySubscribeStatus:!0})})),ne(!0),H(!1),ge((function(e){return i({},e,{voucherifySubscribeStatus:k})}));else{var t={},r={};n.forEach((function(e){t[e.id]="",r[e.id]=!0})),ge((function(e){return i({},e,t)})),be((function(e){return i({},e,r)})),fe(n)}re(!1)})).catch((function(e){re(!1),H(!1),console.error(e),be((function(e){return i({},e,{voucherifySubscribe:!1})})),ge((function(e){return i({},e,{voucherifySubscribeStatus:k})})),"function"==typeof O&&O(e)}))}),[j,ee]);n.useEffect((function(){Se()}),[Se]);var ke=Object.keys(he).map((function(e){return{name:e,classes:u(["voucherifySubscribeStatus"===e||"voucherifySubscribe"===e?e:"voucherifyCustomer"+c(e),X?ve[e]?"":L+" "+q:""])}})),Ce={name:"e.g. Bruce Wayne",email:"e.g. bruce@wayne.com",phone:"e.g. +48 000 000 000",line_1:"e.g. Wayne Manor",line_2:"e.g. 22B",postal_code:"e.g. 00-0014",city:"e.g. Gotham",state:"e.g. New Jersey",country:"e.g. USA"},_e=function(e,t){return void 0===t&&(t=""),n.createElement("input",{type:"phone"===e?"tel":"email"===e?"email":"text",placeholder:t||Ce[""+e],name:e,value:he[""+e],onChange:de,className:ke.find((function(n){return n.name===e})).classes,disabled:ce||B,style:{display:$?"block":"none"}})},Ie=n.useCallback((function(e){ae(!0),ge((function(e){return i({},e,{voucherifySubscribeStatus:""})})),Y(!0);var n={source_id:he.email,name:he.name,phone:he.phone.replace(/[\r\n\t\f\s\v]/g,"").trim(),email:he.email,address:{line_1:he.line_1,line_2:he.line_2,postal_code:he.postal_code,city:he.city,state:he.state,country:he.country}},t=a(n),r=me.reduce((function(e,n){return j||null==n||!n.required||null==n||!n.id||"off"!==he[n.id]&&""!==he[n.id].trim()?null!=n&&n.required&&null!=n&&n.name&&""===he[n.name].trim()?(e[n.name]=!1,e):"phone"===(null==n?void 0:n.name)&&""!==he.phone.replace(/[\r\n\t\f\s\v]/g,"").trim()?(e.phone=l(he.phone.replace(/[\r\n\t\f\s\v]/g,"").trim()),e):"email"===(null==n?void 0:n.name)&&""!==he.email.replace(/[\r\n\t\f\s\v]/g,"").trim()?(e.email=s(he.email.replace(/[\r\n\t\f\s\v]/g,"").trim()),e):(null!=n&&n.name?e[n.name]=!0:null!=n&&n.id&&(e[n.id]=!0),e):(e[n.id]=!1,e)}),i({},ve));be((function(e){return i({},e,r)})),Object.values(r).some((function(e){return!e}))?ae(!1):ue.createCustomer(t,j).then((function(e){if("unconfirmed_customer"!==e.object){if(ge((function(e){return i({},e,{voucherifySubscribeStatus:K})})),0!==se.length){var n=e.id,t=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n.indexOf(t=o[i])>=0||(r[t]=e[t]);return r}(he,["name","email","phone","line_1","line_2","postal_code","city","state","country","voucherifySubscribeStatus","voucherifySubscribe","voucherifyTracking"]);return Object.keys(t).forEach((function(e){t[e]="on"===t[e]})),ue.updateConsents(n,t)}}else ge((function(e){return i({},e,{voucherifySubscribeStatus:"Confirm your subscription to our list. Check your email for further instructions."})}))})).then((function(e){G(!0),H(!1),be((function(e){return i({},e,{voucherifySubscribeStatus:!0})})),ge((function(e){return i({},e,{name:"",email:"",phone:"",line_1:"",line_2:"",postal_code:"",city:"",state:"",country:"",voucherifySubscribe:""})})),"function"==typeof T&&T(e)})).catch((function(e){H(!1),console.error(e),be((function(e){return i({},e,{voucherifySubscribe:!1})})),ge((function(e){return i({},e,{voucherifySubscribeStatus:k})})),"function"==typeof O&&O(e)})).finally((function(){return ae(!1)}))}),[he,O,T]);return n.createElement("div",{className:"voucherifyContainer wide"},n.createElement(r,{src:E,alt:N}),ie?n.createElement("div",{className:"loader"},"Loading consents..."):n.createElement(n.Fragment,null,U.some((function(e){return"name"===e.name}))&&_e("name",null==(t=U.find((function(e){return"name"===e.name})))?void 0:t.placeholder),n.createElement("div",{className:"voucherifyRow",style:{display:$?"flex":"none"}},_e("email",V),U.some((function(e){return"phone"===e.name}))&&_e("phone",null==(o=U.find((function(e){return"phone"===e.name})))?void 0:o.placeholder)),U.some((function(e){return"line_1"===e.name}))&&_e("line_1",null==(m=U.find((function(e){return"line_1"===e.name})))?void 0:m.placeholder),U.some((function(e){return"line_2"===e.name}))&&_e("line_2",null==(y=U.find((function(e){return"line_2"===e.name})))?void 0:y.placeholder),U.some((function(e){return"postal_code"===e.name||"city"===e.name}))&&n.createElement("div",{className:"voucherifyRow",style:{display:$?"flex":"none"}},U.some((function(e){return"postal_code"===e.name}))&&_e("postal_code",null==(h=U.find((function(e){return"postal_code"===e.name})))?void 0:h.placeholder),U.some((function(e){return"city"===e.name}))&&_e("city",null==(v=U.find((function(e){return"city"===e.name})))?void 0:v.placeholder)),U.some((function(e){return"state"===e.name||"country"===e.name}))&&n.createElement("div",{className:"voucherifyRow",style:{display:$?"flex":"none"}},U.some((function(e){return"state"===e.name}))&&_e("state",null==(d=U.find((function(e){return"state"===e.name})))?void 0:d.placeholder),U.some((function(e){return"country"===e.name}))&&_e("country",null==(p=U.find((function(e){return"country"===e.name})))?void 0:p.placeholder)),n.createElement("div",{className:ee?"voucherifySubscribeStatus "+L+" "+q:"voucherifySubscribeStatus "+M+" "+W,style:{display:$?"none":"block"}},n.createElement("p",null,he.voucherifySubscribeStatus)),!j&&0!==se.length&&se.map((function(e){return n.createElement(n.Fragment,null,ke.some((function(n){return n.name===e.id}))&&n.createElement("label",{className:"voucherifyCheckboxContainer",style:{display:$?"block":"none"}},e.description,n.createElement("input",{type:"checkbox",id:e.name,name:e.id,onChange:de,value:"on"===he[e.id]?"on":"off"}),n.createElement("span",{className:"voucherifyCheckmark "+ke.find((function(n){return n.name===e.id})).classes})))})),n.createElement("button",{className:ke.find((function(e){return"voucherifySubscribe"===e.name})).classes,disabled:ce||B,onClick:Ie,style:{display:$?"block":"none"}},n.createElement("span",{className:"voucherifySubscribeText"},D))))},e.VoucherifyValidate=function(e){var t=e.apiUrl,o=e.clientApplicationId,c=e.clientSecretKey,l=e.trackingId,s=e.origin,h=e.logoSrc,v=e.logoAlt,d=e.onValidated,p=e.onError,g=e.amount,b=e.textPlaceholder,S=e.amountPlaceholder,k=e.textValidate,C=void 0===k?"Validate":k,_=e.classInvalid||"voucherifyInvalid",I=e.classValid||"voucherifyValid",A=e.classInvalidAnimation||"voucherifyAnimationShake",E=e.classValidAnimation||"voucherifyAnimationTada",N=n.useState(!1),P=N[0],T=N[1],O=f({apiUrl:t,clientApplicationId:o,clientSecretKey:c,trackingId:l,origin:s}),V=O[0],x=O[1],U=O[2],R=function(){var e=n.useState(m),t=e[0],r=e[1],o=n.useState(y),u=o[1];return{input:t,inputState:o[0],onInputChange:n.useCallback((function(e){e.persist();var n=e.target.name;r((function(t){var r;return i({},t,((r={})[n]=e.target.value,r))}))}),[]),resetInputs:n.useCallback((function(){r(m),u(y)}),[]),setInput:r,setInputState:u}}(),j=R.input,w=R.inputState,D=R.onInputChange,F=R.resetInputs,K=R.setInput,L=R.setInputState,M=n.useState(!1),q=M[0],W=M[1];n.useEffect((function(){F(),T(!1)}),[V]);var z=Object.keys(w).map((function(e){return{name:e,classes:u([e,q?w[e]?I+" "+E:_+" "+A:""])}})),B=n.useCallback((function(e){if(K((function(e){return i({},e,{voucherifyDiscountType:"",voucherifyAmountOff:0,voucherifyUnitOff:0,voucherifyPercentOff:0,voucherifyTracking:""})})),L((function(e){return i({},e,{voucherifyValidate:!1})})),j.voucherifyCode.trim()){var n={code:j.voucherifyCode,amount:""===j.voucherifyAmount.trim()||isNaN(parseInt((100*parseFloat(j.voucherifyAmount.replace(/,/,"."))).toString(),10))?0:parseInt((100*parseFloat(j.voucherifyAmount.replace(/,/,"."))).toString(),10)},t=a(n);U(!0),V.validate(t).then((function(e){var n=e;if(n&&n.valid){if(null!=n&&n.discount){var t=null==n?void 0:n.discount;switch(t.type){case"AMOUNT":K((function(e){return i({},e,{voucherifyDiscountType:t.type||"",voucherifyAmountOff:t.amount_off||0,voucherifyUnitOff:0,voucherifyPercentOff:0,voucherifyTracking:(null==n?void 0:n.tracking_id)||""})}));break;case"UNIT":K((function(e){return i({},e,{voucherifyDiscountType:t.type||"",voucherifyAmountOff:0,voucherifyUnitOff:t.unit_off||0,voucherifyPercentOff:0,voucherifyTracking:(null==n?void 0:n.tracking_id)||""})}));break;case"PERCENT":K((function(e){return i({},e,{voucherifyDiscountType:t.type||"",voucherifyAmountOff:0,voucherifyUnitOff:0,voucherifyPercentOff:t.percent_off||0,voucherifyTracking:(null==n?void 0:n.tracking_id)||""})}))}}else K((function(e){var t;return i({},e,{voucherifyDiscountType:"GIFT_CARD",voucherifyAmountOff:(null==n||null==(t=n.order)?void 0:t.total_discount_amount)||0,voucherifyUnitOff:0,voucherifyPercentOff:0,voucherifyTracking:(null==n?void 0:n.tracking_id)||""})}));T(!0),L((function(e){return i({},e,{voucherifyCode:!0,voucherifyAmount:!0,voucherifyValidate:!0})})),"function"==typeof d&&d(n)}else L((function(e){return i({},e,{voucherifyValidate:!1,voucherifyAmount:!1,voucherifyCode:!1})}))})).catch((function(e){console.error(e),"missing_order"===e.key&&L((function(e){return i({},e,{voucherifyValidate:!1,voucherifyAmount:!1,voucherifyCode:!1})})),"function"==typeof p&&p(e)})).finally((function(){U(!1),W(!0)}))}else L((function(e){return i({},e,{voucherifyCode:!1})}))}),[j,p,d,g]);return n.createElement("div",{className:"voucherifyContainer"},n.createElement(r,{src:h,alt:v}),n.createElement("input",{type:"text",placeholder:b||"e.g. abc-123",name:"voucherifyCode",value:j.voucherifyCode,onChange:D,className:z.find((function(e){return"voucherifyCode"===e.name})).classes,disabled:x||P}),n.createElement("input",{type:g?"text":"hidden",placeholder:S||"e.g. 52.22",name:"voucherifyAmount",value:j.voucherifyAmount,onChange:D,className:z.find((function(e){return"voucherifyAmount"===e.name})).classes,disabled:x||P}),n.createElement("input",{type:"hidden",name:"voucherifyDiscountType",value:j.voucherifyDiscountType,className:"voucherifyDiscountType"}),n.createElement("input",{type:"hidden",name:"voucherifyPercentOff",value:j.voucherifyPercentOff,className:"voucherifyPercentOff"}),n.createElement("input",{type:"hidden",name:"voucherifyAmountOff",value:j.voucherifyAmountOff,className:"voucherifyAmountOff"}),n.createElement("input",{type:"hidden",name:"voucherifyUnitOff",value:j.voucherifyUnitOff,className:"voucherifyUnitOff"}),n.createElement("input",{type:"hidden",name:"voucherifyTracking",value:j.voucherifyTracking,className:"voucherifyTracking"}),n.createElement("button",{className:z.find((function(e){return"voucherifyValidate"===e.name})).classes,disabled:x||P,onClick:B},n.createElement("span",{className:"voucherifyValidateText"},C)))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=voucherifywidget.umd.production.min.js.map
